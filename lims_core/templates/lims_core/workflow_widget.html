{% load static %}

<div class="workflow-widget workflow-card"
     data-kind="{{ workflow_kind }}"
     data-id="{{ workflow_object_id }}">

  <div class="workflow-header">
    <div class="workflow-title">
      <strong>Workflow</strong>
      <div class="muted workflow-subtitle">Lifecycle management</div>
    </div>

    <div class="workflow-status">
      <span class="status-pill status-loading" data-wf-status>Loading…</span>
      <span class="sla-pill" data-wf-sla-pill hidden></span>
    </div>
  </div>

  <div class="workflow-sla-meta muted" data-wf-sla-meta hidden>
    <span data-wf-sla-age></span>
    ·
    <span data-wf-sla-remaining></span>
  </div>

  <div class="workflow-actions">
    <label>Next status</label>

    <div class="workflow-action-row">
      <select data-wf-next></select>

      <input type="text"
             data-wf-comment
             placeholder="Optional comment (audit trail)">

      <button type="button" data-wf-apply disabled>
        Apply
      </button>
    </div>
  </div>

  <div class="workflow-error" data-wf-error hidden></div>

  <div class="workflow-timeline">
    <div style="font-weight:600; margin-bottom:6px;">History</div>
    <div data-wf-timeline></div>
  </div>

</div>

<script>
(function () {
  const widget = document.currentScript.previousElementSibling;
  if (!widget) return;

  widget.addEventListener("click", function (e) {
    if (!widget.contains(e.target)) return;
  }, false);
})();
</script>
